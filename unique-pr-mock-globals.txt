Adding unique changes for PR - Mock globals in test setup and teardown for improved testing
